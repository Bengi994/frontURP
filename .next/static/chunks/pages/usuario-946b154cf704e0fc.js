(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[121],{6065:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/usuario",function(){return __webpack_require__(858)}])},1662:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{U:function(){return useUsers}});var _utils_api__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2400),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7294);let useUsers=()=>{let[users,setUsers]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]),createUser=async data=>{var ref;let response=await _utils_api__WEBPACK_IMPORTED_MODULE_0__.h.post("/auth/local/register",{...data,username:data.email}).catch(response=>response.response);if(null===(ref=response.data)||void 0===ref?void 0:ref.error){let{details:{errors}}=response.data.error;for(let{path,message}of errors)path.includes("dni")&&message.includes("unique")&&alert("Este DNI ya se encuentra registrado por otro usuario");return!1}return await getUsers(),200===response.status},updateUser=async data=>{var ref;let response=await _utils_api__WEBPACK_IMPORTED_MODULE_0__.h.put("/users/".concat(data.id),{nombre:data.nombre,apellido:data.apellido,dni:data.dni,email:data.email,username:data.email,...data.password&&{password:data.password},rol:{id:data.role.id},conferencias:data.conferencias}).catch(response=>response.response);if(null===(ref=response.data)||void 0===ref?void 0:ref.error){let{details:{errors}}=response.data.error;for(let{path,message}of errors)path.includes("dni")&&message.includes("unique")&&alert("Este DNI ya se encuentra registrado por otro usuario");return!1}return await getUsers(),200===response.status},removeUser=async userId=>{let response=await _utils_api__WEBPACK_IMPORTED_MODULE_0__.h.put("/users/".concat(userId),{blocked:!0});return await getUsers(),200===response.status},enableUser=async userId=>{let response=await _utils_api__WEBPACK_IMPORTED_MODULE_0__.h.put("/users/".concat(userId),{blocked:!1});return await getUsers(),200===response.status},getUsers=async()=>{let{data}=await _utils_api__WEBPACK_IMPORTED_MODULE_0__.h.get("/users");setUsers(data)};return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{getUsers()},[]),{users,createUser,updateUser,removeUser,enableUser}}},858:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return usuario}});var jsx_runtime=__webpack_require__(5893),ResponsivePage=__webpack_require__(8776),Button=__webpack_require__(5005),react=__webpack_require__(7294),Modal=__webpack_require__(3025),Form=__webpack_require__(1676),index_esm=__webpack_require__(7536),api=__webpack_require__(2400);let useUser=()=>{let[roles,setRoles]=(0,react.useState)([]),getRoles=async()=>{let{data:{roles:rolesRaw}}=await api.h.get("/users-permissions/roles"),rolesMapping=rolesRaw.filter(role=>![1,2,3].includes(role.id)).map(param=>{let{id,description}=param;return{id,name:description}});setRoles(rolesMapping)};return(0,react.useEffect)(()=>{getRoles()},[]),{roles}};var es=__webpack_require__(4231),yup=__webpack_require__(7533);let getUserSchema=isNew=>isNew?es.Ry({nombre:es.Z_().required("El nombre es requerido"),apellido:es.Z_().required("El apellido es requerida"),dni:es.Z_().typeError("El DNI debe ser un digitos numericos").required("El DNI es requerido").max(8,"Tiene ser un maximo de 8 digitos").min(8,"Tiene ser un maximo de 8 digitos"),email:es.Z_().required("El email es requerido").email("EL email tiene que tener el siguiente formato ejemplo@ejemplo.com"),password:es.Z_().required("El password es requerido").min(6,"El password tiene que tener como minimo 6 caracteres"),role:es.Ry({id:es.Rx().required("El rol es requerido")})}).required():es.Ry({nombre:es.Z_().required("El nombre es requerido"),apellido:es.Z_().required("El apellido es requerida"),dni:es.Z_().typeError("El DNI debe ser un digitos numericos").required("El DNI es requerido").max(8,"Tiene ser un maximo de 8 digitos").min(8,"Tiene ser un maximo de 8 digitos"),email:es.Z_().required("El tipo de producto es requerido").email("EL email tiene que tener el siguiente formato ejemplo@ejemplo.com"),password:es.Z_(),role:es.Ry({id:es.Rx().required("El rol es requerido")})}).required(),UserModal=param=>{var ref;let{show,handleClose,isNew,onSubmit,user}=param,{register,handleSubmit,formState:{errors},setValue}=(0,index_esm.cI)({resolver:(0,yup.X)(getUserSchema(isNew)),defaultValues:user}),{roles}=useUser();return(0,jsx_runtime.jsx)(Modal.Z,{show:show,onHide:handleClose,children:(0,jsx_runtime.jsxs)(Form.Z,{onSubmit:handleSubmit(data=>onSubmit(data,isNew)),children:[(0,jsx_runtime.jsx)(Modal.Z.Header,{closeButton:!0,children:(0,jsx_runtime.jsxs)(Modal.Z.Title,{children:[isNew?"Crear":"Editar"," Usuario"]})}),(0,jsx_runtime.jsxs)(Modal.Z.Body,{children:[(0,jsx_runtime.jsxs)(Form.Z.Group,{className:"mb-3",children:[(0,jsx_runtime.jsx)(Form.Z.Label,{children:"Nombre"}),(0,jsx_runtime.jsx)(Form.Z.Control,{type:"text",...register("nombre")}),errors.nombre&&(0,jsx_runtime.jsx)(Form.Z.Text,{className:"text-danger",children:errors.nombre.message})]}),(0,jsx_runtime.jsxs)(Form.Z.Group,{className:"mb-3",children:[(0,jsx_runtime.jsx)(Form.Z.Label,{children:"Apellido"}),(0,jsx_runtime.jsx)(Form.Z.Control,{type:"text",...register("apellido")}),errors.apellido&&(0,jsx_runtime.jsx)(Form.Z.Text,{className:"text-danger",children:errors.apellido.message})]}),(0,jsx_runtime.jsxs)(Form.Z.Group,{className:"mb-3",children:[(0,jsx_runtime.jsx)(Form.Z.Label,{children:"DNI"}),(0,jsx_runtime.jsx)(Form.Z.Control,{type:"number",...register("dni")}),errors.dni&&(0,jsx_runtime.jsx)(Form.Z.Text,{className:"text-danger",children:errors.dni.message})]}),(0,jsx_runtime.jsxs)(Form.Z.Group,{className:"mb-3",children:[(0,jsx_runtime.jsx)(Form.Z.Label,{children:"Email"}),(0,jsx_runtime.jsx)(Form.Z.Control,{type:"email",...register("email")}),errors.email&&(0,jsx_runtime.jsx)(Form.Z.Text,{className:"text-danger",children:errors.email.message})]}),(0,jsx_runtime.jsxs)(Form.Z.Group,{className:"mb-3",children:[(0,jsx_runtime.jsx)(Form.Z.Label,{children:"Password"}),(0,jsx_runtime.jsx)(Form.Z.Control,{type:"password",...register("password")}),errors.password&&(0,jsx_runtime.jsx)(Form.Z.Text,{className:"text-danger",children:errors.password.message})]}),(0,jsx_runtime.jsxs)(Form.Z.Group,{className:"mb-3",children:[(0,jsx_runtime.jsx)(Form.Z.Label,{children:"Rol"}),(0,jsx_runtime.jsxs)(Form.Z.Select,{onChange:event=>setValue("role.id",Number(event.target.value)),value:null==user?void 0:user.role.id,children:[(0,jsx_runtime.jsx)("option",{children:"Seleccionar"}),roles.length>0&&roles.map(rol=>(0,jsx_runtime.jsx)("option",{value:rol.id,children:rol.name},"rol-".concat(rol.id)))]}),(null===(ref=errors.role)||void 0===ref?void 0:ref.id)&&(0,jsx_runtime.jsx)(Form.Z.Text,{className:"text-danger",children:errors.role.id.message})]})]}),(0,jsx_runtime.jsxs)(Modal.Z.Footer,{children:[(0,jsx_runtime.jsx)(Button.Z,{variant:"secondary",onClick:handleClose,children:"Cerrar"}),(0,jsx_runtime.jsx)(Button.Z,{variant:"primary",type:"submit",children:isNew?"Crear":"Editar"})]})]})})};var useUsers=__webpack_require__(1662);let Usuario=()=>{let[showModal,setShowModal]=(0,react.useState)(!1),[selectedUser,setSelectedUser]=(0,react.useState)(void 0),[isNew,setIsNew]=(0,react.useState)(!0),{createUser,users,updateUser,removeUser,enableUser}=(0,useUsers.U)(),handleOnCloseModal=()=>{setSelectedUser(void 0),setIsNew(!0),setShowModal(!1)},handleOnOpenModal=()=>setShowModal(!0),handleOnSubmit=async(data,isNew)=>{(isNew?await createUser(data):await updateUser(data))&&handleOnCloseModal()},handleOnEdit=user=>{setIsNew(!1),setSelectedUser(user),handleOnOpenModal()},handleOnRemove=async userId=>{let hasAManager=users.some(user=>4===user.role.id&&!user.blocked&&user.id!==userId);if(!hasAManager)return alert("No puedes deshabilitar esta cuenta ya que te quedarias sin Gerente");await removeUser(userId)},handleOnEnable=async userId=>{await enableUser(userId)};return(0,jsx_runtime.jsxs)(ResponsivePage.Y,{children:[(0,jsx_runtime.jsxs)("div",{className:"container mt-3",children:[(0,jsx_runtime.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,jsx_runtime.jsx)("h1",{className:"mb-2",children:"Usuarios"}),(0,jsx_runtime.jsx)(Button.Z,{variant:"success",onClick:handleOnOpenModal,children:"Nuevo"})]}),(0,jsx_runtime.jsxs)("table",{className:"table",children:[(0,jsx_runtime.jsx)("thead",{children:(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("th",{scope:"col",children:"#"}),(0,jsx_runtime.jsx)("th",{scope:"col",children:"Nombre Completo"}),(0,jsx_runtime.jsx)("th",{scope:"col",children:"DNI"}),(0,jsx_runtime.jsx)("th",{scope:"col",children:"Correo"}),(0,jsx_runtime.jsx)("th",{scope:"col",children:"Rol"}),(0,jsx_runtime.jsx)("th",{scope:"col",children:"Estado"}),(0,jsx_runtime.jsx)("th",{scope:"col"})]})}),(0,jsx_runtime.jsx)("tbody",{children:users.length>0&&users.map(user=>(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("td",{children:user.id}),(0,jsx_runtime.jsxs)("td",{children:[user.nombre," ",user.apellido]}),(0,jsx_runtime.jsx)("td",{children:user.dni}),(0,jsx_runtime.jsx)("td",{children:user.email}),(0,jsx_runtime.jsx)("td",{children:user.role.name}),(0,jsx_runtime.jsx)("td",{children:user.blocked?"No Dispnible":"Disponible"}),(0,jsx_runtime.jsxs)("td",{children:[(0,jsx_runtime.jsx)(Button.Z,{className:"me-2",variant:"danger",onClick:()=>handleOnRemove(user.id),children:"Eliminar"}),(0,jsx_runtime.jsx)(Button.Z,{className:"me-2",variant:"primary",onClick:()=>handleOnEdit(user),children:"Editar"}),(0,jsx_runtime.jsx)(Button.Z,{variant:"info",onClick:()=>handleOnEnable(user.id),children:"Habilitar"})]})]},"user-".concat(user.id)))})]})]}),showModal&&(0,jsx_runtime.jsx)(UserModal,{show:showModal,handleClose:handleOnCloseModal,isNew:isNew,onSubmit:handleOnSubmit,user:selectedUser})]})};var usuario=Usuario}},function(__webpack_require__){__webpack_require__.O(0,[222,536,676,491,25,776,774,888,179],function(){return __webpack_require__(__webpack_require__.s=6065)}),_N_E=__webpack_require__.O()}]);